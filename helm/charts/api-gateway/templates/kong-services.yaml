# Kong Services Configuration
# Register all 254Carbon platform services with Kong

---
# DataHub GMS API
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: datahub-gms
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-datahub,prometheus
spec:
  host: datahub-gms.data-platform.svc.cluster.local
  port: 8080
  protocol: http
  path: /
  retries: 3
  connect_timeout: 60000
  write_timeout: 60000
  read_timeout: 60000

---
# Trino Query Engine
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: trino
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-trino,prometheus
spec:
  host: trino-coordinator.data-platform.svc.cluster.local
  port: 8080
  protocol: http
  path: /
  retries: 0  # Don't retry queries
  connect_timeout: 60000
  write_timeout: 3600000  # 1 hour for long queries
  read_timeout: 3600000

---
# Superset BI Tool
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: superset
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-superset,cors,prometheus
spec:
  host: superset-web.data-platform.svc.cluster.local
  port: 8088
  protocol: http
  path: /
  retries: 2
  connect_timeout: 60000
  write_timeout: 60000
  read_timeout: 60000

---
# DolphinScheduler Workflow API
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: dolphinscheduler
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-dolphin,prometheus
spec:
  host: dolphinscheduler-api-service.data-platform.svc.cluster.local
  port: 12345
  protocol: http
  path: /
  retries: 2
  connect_timeout: 60000
  write_timeout: 120000
  read_timeout: 120000

---
# MinIO S3 API
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: minio-api
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-minio,prometheus
spec:
  host: minio.data-platform.svc.cluster.local
  port: 9000
  protocol: http
  path: /
  retries: 3
  connect_timeout: 60000
  write_timeout: 300000  # 5 minutes for large uploads
  read_timeout: 300000

---
# MLflow Tracking Server
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: mlflow
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-mlflow,prometheus
spec:
  host: mlflow-service.data-platform.svc.cluster.local
  port: 5000
  protocol: http
  path: /
  retries: 2
  connect_timeout: 60000
  write_timeout: 60000
  read_timeout: 60000

---
# Iceberg REST Catalog
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: iceberg-rest
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-iceberg,prometheus
spec:
  host: iceberg-rest-catalog.data-platform.svc.cluster.local
  port: 8181
  protocol: http
  path: /
  retries: 2
  connect_timeout: 60000
  write_timeout: 120000
  read_timeout: 120000

---
# Portal Services API
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: portal-services
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-portal,cors,prometheus
spec:
  host: portal-services.data-platform.svc.cluster.local
  port: 8080
  protocol: http
  path: /
  retries: 3
  connect_timeout: 10000
  write_timeout: 10000
  read_timeout: 10000

---
# Grafana Monitoring
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: grafana
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-grafana,prometheus
spec:
  host: grafana.monitoring.svc.cluster.local
  port: 3000
  protocol: http
  path: /
  retries: 2
  connect_timeout: 60000
  write_timeout: 60000
  read_timeout: 60000

---
# Prometheus Metrics
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: prometheus
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-prometheus
spec:
  host: prometheus.monitoring.svc.cluster.local
  port: 9090
  protocol: http
  path: /
  retries: 2
  connect_timeout: 30000
  write_timeout: 30000
  read_timeout: 30000

---
# Kafka REST Proxy (if deployed)
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: kafka-rest
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-kafka,prometheus
spec:
  host: kafka-rest-proxy.data-platform.svc.cluster.local
  port: 8082
  protocol: http
  path: /
  retries: 2
  connect_timeout: 30000
  write_timeout: 30000
  read_timeout: 30000

---
# Schema Registry
apiVersion: configuration.konghq.com/v1
kind: KongService
metadata:
  name: schema-registry
  namespace: kong
  annotations:
    konghq.com/plugins: rate-limiting-schema,prometheus
spec:
  host: schema-registry.data-platform.svc.cluster.local
  port: 8081
  protocol: http
  path: /
  retries: 2
  connect_timeout: 30000
  write_timeout: 30000
  read_timeout: 30000



