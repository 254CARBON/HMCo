apiVersion: v1
kind: Secret
metadata:
  name: cloudflare-tunnel-credentials
  namespace: cloudflare-tunnel
  labels:
    app.kubernetes.io/name: cloudflare-tunnel
type: Opaque
stringData:
  # This will be base64-encoded by kubectl
  # Format: tunnel_id:account_tag:tunnel_name:auth_token
  # Populate this with actual credentials from Cloudflare dashboard
  credentials.json: |
    {
      "tunnel_id": "YOUR_TUNNEL_ID_HERE",
      "account_tag": "YOUR_ACCOUNT_TAG_HERE",
      "tunnel_name": "254carbon-cluster",
      "auth_token": "YOUR_AUTH_TOKEN_HERE",
      "tunnel_remote_config": true
    }

---
# ConfigMap for cloudflared configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudflared-config
  namespace: cloudflare-tunnel
  labels:
    app.kubernetes.io/name: cloudflare-tunnel
data:
  config.yaml: |
    # Cloudflare Tunnel Configuration for 254carbon.com
    tunnel: 254carbon-cluster
    credentials-file: /etc/cloudflare-tunnel/creds/credentials.json
    metrics: 0.0.0.0:2000
    metrics-update-freq: 5s
    
    # Ingress rules - route to NGINX Ingress Controller
    ingress:
      # Portal and WWW
      - hostname: portal.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: portal.254carbon.com
      - hostname: www.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: www.254carbon.com
      # DataHub UI
      - hostname: datahub.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: datahub.254carbon.com
          
      # Grafana monitoring dashboards
      - hostname: grafana.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: grafana.254carbon.com
          
      # Superset data visualization
      - hostname: superset.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: superset.254carbon.com
          
      # Vault UI
      - hostname: vault.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: vault.254carbon.com
          
      # Trino query UI
      - hostname: trino.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: trino.254carbon.com
          
      # Apache Doris FE UI
      - hostname: doris.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: doris.254carbon.com
          
      # DolphinScheduler workflow orchestration
      - hostname: dolphin.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: dolphin.254carbon.com
          
      # MinIO S3 console
      - hostname: minio.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: minio.254carbon.com
      
      # MLflow UI
      - hostname: mlflow.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: mlflow.254carbon.com
      
      # Spark History Server
      - hostname: spark-history.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: spark-history.254carbon.com
      
      # Harbor UI and Registry
      - hostname: harbor.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: harbor.254carbon.com
          
      # LakeFS (when enabled)
      - hostname: lakefs.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: lakefs.254carbon.com
      
      # RAPIDS GPU Analytics Lab
      - hostname: rapids.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: rapids.254carbon.com
      
      # DolphinScheduler (alternative domain)
      - hostname: dolphinscheduler.254carbon.com
        service: http://ingress-nginx-controller.ingress-nginx:80
        originRequest:
          httpHostHeader: dolphinscheduler.254carbon.com
          
      # Catch-all for root domain and any other services
      - service: http_status:404
