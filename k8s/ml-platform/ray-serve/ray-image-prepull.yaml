apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: ray-image-prepull
  namespace: kube-system
  labels:
    app: ray-image-prepull
    component: prepull
spec:
  selector:
    matchLabels:
      app: ray-image-prepull
  template:
    metadata:
      labels:
        app: ray-image-prepull
        component: prepull
    spec:
      tolerations:
        - operator: Exists
      # Pull heavy Ray images on every node to avoid cold starts
      initContainers:
        - name: prepull-ray-ml
          image: rayproject/ray-ml:2.9.0
          imagePullPolicy: IfNotPresent
          command: ["/bin/sh","-c"]
          args: ["echo 'Ray image pulled'"]
      containers:
        - name: pause
          image: registry.k8s.io/pause:3.9
          imagePullPolicy: IfNotPresent
      hostNetwork: false
      dnsPolicy: ClusterFirst
  updateStrategy:
    type: RollingUpdate

