---
# Simple model deployment
apiVersion: machinelearning.seldon.io/v1
kind: SeldonDeployment
metadata:
  name: commodity-price-predictor
  namespace: data-platform
spec:
  name: commodity-price-predictor
  replicas: 3
  predictors:
  - name: default
    replicas: 3
    graph:
      name: classifier
      type: MODEL
      implementation: MLFLOW_SERVER
      modelUri: models:/commodity_price_predictor/production
      envSecretRefName: mlflow-credentials
    componentSpecs:
    - spec:
        containers:
        - name: classifier
          image: seldonio/mlflowserver:1.17.1
          env:
          - name: MLFLOW_TRACKING_URI
            value: http://mlflow.data-platform.svc.cluster.local:5000
          resources:
            requests:
              cpu: 500m
              memory: 1Gi
            limits:
              cpu: 2
              memory: 4Gi
---
# A/B Testing deployment
apiVersion: machinelearning.seldon.io/v1
kind: SeldonDeployment
metadata:
  name: commodity-predictor-ab-test
  namespace: data-platform
spec:
  name: commodity-predictor-ab-test
  replicas: 3
  predictors:
  # Model A (baseline)
  - name: model-a
    replicas: 2
    traffic: 50
    graph:
      name: model-a
      type: MODEL
      implementation: MLFLOW_SERVER
      modelUri: models:/commodity_price_predictor/1
      envSecretRefName: mlflow-credentials
    componentSpecs:
    - spec:
        containers:
        - name: model-a
          image: seldonio/mlflowserver:1.17.1
          env:
          - name: MLFLOW_TRACKING_URI
            value: http://mlflow.data-platform.svc.cluster.local:5000
          resources:
            requests:
              cpu: 500m
              memory: 1Gi
  # Model B (new version)
  - name: model-b
    replicas: 2
    traffic: 50
    graph:
      name: model-b
      type: MODEL
      implementation: MLFLOW_SERVER
      modelUri: models:/commodity_price_predictor/2
      envSecretRefName: mlflow-credentials
    componentSpecs:
    - spec:
        containers:
        - name: model-b
          image: seldonio/mlflowserver:1.17.1
          env:
          - name: MLFLOW_TRACKING_URI
            value: http://mlflow.data-platform.svc.cluster.local:5000
          resources:
            requests:
              cpu: 500m
              memory: 1Gi
---
# Canary deployment
apiVersion: machinelearning.seldon.io/v1
kind: SeldonDeployment
metadata:
  name: commodity-predictor-canary
  namespace: data-platform
spec:
  name: commodity-predictor-canary
  replicas: 3
  predictors:
  # Main model (90% traffic)
  - name: main
    replicas: 3
    traffic: 90
    graph:
      name: main-model
      type: MODEL
      implementation: MLFLOW_SERVER
      modelUri: models:/commodity_price_predictor/production
      envSecretRefName: mlflow-credentials
  # Canary model (10% traffic)
  - name: canary
    replicas: 1
    traffic: 10
    graph:
      name: canary-model
      type: MODEL
      implementation: MLFLOW_SERVER
      modelUri: models:/commodity_price_predictor/staging
      envSecretRefName: mlflow-credentials
---
# Multi-model ensemble
apiVersion: machinelearning.seldon.io/v1
kind: SeldonDeployment
metadata:
  name: commodity-ensemble
  namespace: data-platform
spec:
  name: commodity-ensemble
  replicas: 2
  predictors:
  - name: ensemble
    replicas: 2
    graph:
      name: random-forest
      type: MODEL
      implementation: MLFLOW_SERVER
      modelUri: models:/commodity_rf/production
      children:
      - name: gradient-boost
        type: MODEL
        implementation: MLFLOW_SERVER
        modelUri: models:/commodity_gb/production
        children: []
      - name: neural-network
        type: MODEL
        implementation: MLFLOW_SERVER
        modelUri: models:/commodity_nn/production
        children: []
---
# Shadow deployment (no production traffic)
apiVersion: machinelearning.seldon.io/v1
kind: SeldonDeployment
metadata:
  name: commodity-shadow
  namespace: data-platform
spec:
  name: commodity-shadow
  replicas: 2
  predictors:
  # Main model
  - name: main
    replicas: 2
    graph:
      name: main-model
      type: MODEL
      implementation: MLFLOW_SERVER
      modelUri: models:/commodity_price_predictor/production
      envSecretRefName: mlflow-credentials
  # Shadow model (receives copy of traffic but doesn't serve responses)
  - name: shadow
    replicas: 1
    shadow: true
    graph:
      name: shadow-model
      type: MODEL
      implementation: MLFLOW_SERVER
      modelUri: models:/commodity_price_predictor/experimental
      envSecretRefName: mlflow-credentials
---
# Pre-processor + Model pipeline
apiVersion: machinelearning.seldon.io/v1
kind: SeldonDeployment
metadata:
  name: commodity-with-preprocessing
  namespace: data-platform
spec:
  name: commodity-with-preprocessing
  replicas: 2
  predictors:
  - name: default
    replicas: 2
    graph:
      name: preprocessor
      type: TRANSFORMER
      implementation: PYTHON
      modelUri: s3://mlpipelines/transformers/commodity-preprocessor
      children:
      - name: model
        type: MODEL
        implementation: MLFLOW_SERVER
        modelUri: models:/commodity_price_predictor/production
        envSecretRefName: mlflow-credentials
        children: []
---
# Explainer deployment (SHAP integration)
apiVersion: machinelearning.seldon.io/v1
kind: SeldonDeployment
metadata:
  name: commodity-with-explainer
  namespace: data-platform
spec:
  name: commodity-with-explainer
  replicas: 2
  predictors:
  - name: default
    replicas: 2
    graph:
      name: model
      type: MODEL
      implementation: MLFLOW_SERVER
      modelUri: models:/commodity_price_predictor/production
      envSecretRefName: mlflow-credentials
    explainer:
      type: AnchorTabular
      containerSpec:
        name: explainer
        image: seldonio/alibi-explain-server:1.17.1
        env:
        - name: PREDICTIVE_UNIT_PARAMETERS
          value: '[{"type":"STRING","name":"predict_fn","value":"classifier"}]'
---
# Model with feature server (Feast integration)
apiVersion: machinelearning.seldon.io/v1
kind: SeldonDeployment
metadata:
  name: commodity-with-features
  namespace: data-platform
spec:
  name: commodity-with-features
  replicas: 2
  predictors:
  - name: default
    replicas: 2
    graph:
      name: feast-transformer
      type: TRANSFORMER
      endpoint:
        type: GRPC
      implementation: PYTHON
      modelUri: s3://mlpipelines/transformers/feast-transformer
      env:
      - name: FEAST_FEATURE_SERVER
        value: http://feast-server.data-platform.svc.cluster.local:8080
      children:
      - name: model
        type: MODEL
        implementation: MLFLOW_SERVER
        modelUri: models:/commodity_price_predictor/production
        envSecretRefName: mlflow-credentials



