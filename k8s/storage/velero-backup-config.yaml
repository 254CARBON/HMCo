# Velero Backup Configuration for 254Carbon Platform

---
# Velero Backup Storage Location (MinIO / S3-compatible)
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
  name: default
  namespace: velero
spec:
  provider: aws
  accessMode: ReadWrite
  objectStorage:
    bucket: 254carbon-backups
    prefix: cluster-backups
  config:
    region: us-east-1
    s3ForcePathStyle: "true"
    s3Url: http://minio-service.data-platform.svc.cluster.local:9000
    publicUrl: http://minio-service.data-platform.svc.cluster.local:9000
    insecureSkipTLSVerify: "true"
  credential:
    name: minio-backup-credentials
    key: cloud

---
# Default Backup Schedule (Daily at 02:00, retain for 30 days)
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: daily-backup
  namespace: velero
  labels:
    velero.254carbon.com/tier: standard
spec:
  schedule: "0 2 * * *"
  template:
    includedNamespaces:
      - data-platform
      - monitoring
      - registry
      - vault-prod
      - cloudflare-tunnel
    snapshotVolumes: true
    ttl: 720h0m0s
    storageLocation: default

---
# Critical systems backup (Every 6 hours, retain for 7 days)
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: critical-backup
  namespace: velero
  labels:
    velero.254carbon.com/tier: critical
spec:
  schedule: "0 */6 * * *"
  template:
    includedNamespaces:
      - data-platform
      - vault-prod
    snapshotVolumes: true
    ttl: 168h0m0s
    storageLocation: default

---
# PostgreSQL-specific backup (Daily at 03:00, retain for 7 days)
apiVersion: velero.io/v1
kind: Schedule
metadata:
  name: postgres-backup
  namespace: velero
  labels:
    velero.254carbon.com/tier: database
spec:
  schedule: "0 3 * * *"
  template:
    includedNamespaces:
      - data-platform
    labelSelector:
      matchLabels:
        app: postgres
    snapshotVolumes: true
    ttl: 168h0m0s
    storageLocation: default
