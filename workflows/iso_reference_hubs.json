{
  "name": "iso_reference_hubs",
  "description": "ISO hub reference data pipeline (SCD2)",
  "schedule": "0 3 * * 0",
  "timezone": "UTC",
  "tasks": [
    {
      "name": "fetch_caiso_hubs",
      "type": "SHELL",
      "command": "python /app/sdk/uis/tools/iso_adapters/caiso_reference.py --type hubs --output /tmp/caiso_hubs.json"
    },
    {
      "name": "fetch_miso_hubs",
      "type": "SHELL",
      "command": "python /app/sdk/uis/tools/iso_adapters/miso_reference.py --type hubs --output /tmp/miso_hubs.json"
    },
    {
      "name": "fetch_spp_hubs",
      "type": "SHELL",
      "command": "python /app/sdk/uis/tools/iso_adapters/spp_reference.py --type hubs --output /tmp/spp_hubs.json"
    },
    {
      "name": "compile_spark_job",
      "type": "SHELL",
      "command": "python /app/sdk/uis/compilers/spark/compiler.py --spec /app/sdk/uis/compilers/spark/fixtures/iso_reference_hubs.json --output /tmp/ref_hubs_job.conf",
      "dependsOn": ["fetch_caiso_hubs", "fetch_miso_hubs", "fetch_spp_hubs"]
    },
    {
      "name": "run_scd2_merge",
      "type": "SPARK",
      "config": "/tmp/ref_hubs_job.conf",
      "dependsOn": ["compile_spark_job"]
    },
    {
      "name": "data_quality",
      "type": "PYTHON",
      "script": "/app/data-quality/runner.py",
      "args": ["--suite", "iso_reference", "--table", "ref.hubs"],
      "dependsOn": ["run_scd2_merge"]
    }
  ],
  "sla": {
    "freshness_hours": 24,
    "alert": {
      "enabled": true,
      "channel": "slack-data-platform",
      "recipients": ["data-eng@254carbon.com"]
    }
  }
}
