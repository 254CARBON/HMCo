---
# PodDisruptionBudgets for Critical Services
# Ensures minimum availability during voluntary disruptions (node drain, upgrades)

apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: datahub-frontend-pdb
  namespace: data-platform
spec:
  minAvailable: 2
  selector:
    matchLabels:
      app: datahub
      component: datahub-frontend

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: datahub-gms-pdb
  namespace: data-platform
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: datahub
      component: datahub-gms

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: trino-coordinator-pdb
  namespace: data-platform
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: trino
      component: coordinator

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: trino-worker-pdb
  namespace: data-platform
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: trino
      component: worker

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: superset-web-pdb
  namespace: data-platform
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: superset
      component: web

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: dolphinscheduler-api-pdb
  namespace: data-platform
spec:
  minAvailable: 2
  selector:
    matchLabels:
      app: dolphinscheduler
      component: api

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: mlflow-pdb
  namespace: data-platform
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: mlflow

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: feast-pdb
  namespace: data-platform
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: feast-server

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: portal-pdb
  namespace: data-platform
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: portal

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: kafka-pdb
  namespace: data-platform
spec:
  maxUnavailable: 1
  selector:
    matchLabels:
      app: kafka

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: postgres-pdb
  namespace: data-platform
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app: postgres-shared

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: prometheus-pdb
  namespace: monitoring
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: prometheus

---
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: grafana-pdb
  namespace: monitoring
spec:
  minAvailable: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: grafana
